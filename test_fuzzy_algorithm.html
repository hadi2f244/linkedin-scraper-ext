<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fuzzy Matching Algorithm</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #0073b1;
        }
        .test-input {
            margin: 20px 0;
        }
        input {
            padding: 10px;
            width: 300px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background: #0073b1;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #005885;
        }
        .results {
            margin-top: 20px;
        }
        .result-item {
            padding: 15px;
            margin: 10px 0;
            background: #f9f9f9;
            border-left: 4px solid #0073b1;
            border-radius: 4px;
        }
        .score {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 3px;
            font-weight: bold;
            margin-left: 10px;
        }
        .score-100 { background: #4caf50; color: white; }
        .score-95 { background: #8bc34a; color: white; }
        .score-85 { background: #cddc39; color: black; }
        .score-75 { background: #ffeb3b; color: black; }
        .score-65 { background: #ffc107; color: black; }
        .score-60 { background: #ff9800; color: white; }
        .score-0 { background: #f44336; color: white; }
        .badge {
            display: inline-block;
            background: #f44336;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Fuzzy Matching Algorithm Test</h1>
        
        <div class="test-input">
            <label><strong>Search Company Name:</strong></label><br>
            <input type="text" id="searchName" placeholder="e.g., Google, Microsoft Corp" value="Google">
            <button onclick="runTest()">Test Match</button>
        </div>

        <div class="test-input">
            <label><strong>CSV Company Name:</strong></label><br>
            <input type="text" id="csvName" placeholder="e.g., Google LLC, Microsoft" value="Google LLC">
        </div>

        <div class="results" id="results"></div>

        <hr style="margin: 30px 0;">

        <h2>Pre-defined Test Cases</h2>
        <button onclick="runAllTests()">Run All Test Cases</button>
        <div id="allResults"></div>
    </div>

    <script>
        // Copy the fuzzy matching functions from background.js
        const normalizeCompanyName = (name) => {
          if (!name) return '';
          return name
            .toLowerCase()
            .replace(/\s+/g, ' ')
            .replace(/[^\w\s&]/g, '')
            .trim();
        };

        const extractCoreCompanyName = (name) => {
          if (!name) return '';
          let core = normalizeCompanyName(name);
          const suffixes = [
            'limited', 'ltd', 'plc', 'llc', 'inc', 'incorporated',
            'corporation', 'corp', 'company', 'co', 'group', 'holdings',
            'international', 'intl', 'uk', 'usa', 'us', 'europe', 'global'
          ];
          for (const suffix of suffixes) {
            const regex = new RegExp(`\\s+${suffix}$`, 'gi');
            core = core.replace(regex, '').trim();
          }
          return core;
        };

        const levenshteinDistance = (str1, str2) => {
          const len1 = str1.length;
          const len2 = str2.length;
          const matrix = Array(len1 + 1).fill(null).map(() => Array(len2 + 1).fill(0));

          for (let i = 0; i <= len1; i++) matrix[i][0] = i;
          for (let j = 0; j <= len2; j++) matrix[0][j] = j;

          for (let i = 1; i <= len1; i++) {
            for (let j = 1; j <= len2; j++) {
              const cost = str1[i - 1] === str2[j - 1] ? 0 : 1;
              matrix[i][j] = Math.min(
                matrix[i - 1][j] + 1,
                matrix[i][j - 1] + 1,
                matrix[i - 1][j - 1] + cost
              );
            }
          }

          return matrix[len1][len2];
        };

        const calculateFuzzyMatchScore = (searchName, csvName) => {
          if (!searchName || !csvName) return 0;

          const n1 = normalizeCompanyName(searchName);
          const n2 = normalizeCompanyName(csvName);
          
          if (!n1 || !n2) return 0;

          if (n1 === n2) return 100;

          const core1 = extractCoreCompanyName(searchName);
          const core2 = extractCoreCompanyName(csvName);

          if (core1 === core2 && core1.length > 0) return 95;

          if (n1.includes(n2) || n2.includes(n1)) {
            const longer = n1.length > n2.length ? n1 : n2;
            const shorter = n1.length > n2.length ? n2 : n1;
            const ratio = shorter.length / longer.length;
            return Math.floor(85 + (ratio * 10));
          }

          if (core1.includes(core2) || core2.includes(core1)) {
            const longer = core1.length > core2.length ? core1 : core2;
            const shorter = core1.length > core2.length ? core2 : core1;
            const ratio = shorter.length / longer.length;
            return Math.floor(75 + (ratio * 10));
          }

          const words1 = core1.split(/\s+/).filter(w => w.length > 2);
          const words2 = core2.split(/\s+/).filter(w => w.length > 2);
          
          if (words1.length > 0 && words2.length > 0) {
            let matchingWords = 0;
            for (const w1 of words1) {
              for (const w2 of words2) {
                if (w1 === w2 || w1.includes(w2) || w2.includes(w1)) {
                  matchingWords++;
                  break;
                }
              }
            }
            const wordMatchRatio = matchingWords / Math.max(words1.length, words2.length);
            if (wordMatchRatio > 0.5) {
              return Math.floor(60 + (wordMatchRatio * 20));
            }
          }

          const maxLen = Math.max(core1.length, core2.length);
          if (maxLen > 0) {
            const distance = levenshteinDistance(core1, core2);
            const similarity = 1 - (distance / maxLen);
            if (similarity > 0.7) {
              return Math.floor(similarity * 70);
            }
          }

          const acronym1 = words1.map(w => w[0]).join('');
          const acronym2 = words2.map(w => w[0]).join('');
          if (acronym1.length >= 2 && acronym2.length >= 2) {
            if (acronym1 === core2 || acronym2 === core1) {
              return 65;
            }
          }

          return 0;
        };

        function getBadgeText(score) {
            if (score === 100) return '‚úì Visa';
            if (score >= 95) return '‚úì Visa 95%+';
            if (score >= 85) return '‚úì Visa ~90%';
            if (score >= 75) return '‚úì Visa ~80%';
            if (score >= 65) return '‚úì Visa ~70%';
            if (score >= 60) return '‚úì Visa ~60%';
            return 'No badge';
        }

        function getScoreClass(score) {
            if (score === 100) return 'score-100';
            if (score >= 95) return 'score-95';
            if (score >= 85) return 'score-85';
            if (score >= 75) return 'score-75';
            if (score >= 65) return 'score-65';
            if (score >= 60) return 'score-60';
            return 'score-0';
        }

        function runTest() {
            const searchName = document.getElementById('searchName').value;
            const csvName = document.getElementById('csvName').value;
            
            const score = calculateFuzzyMatchScore(searchName, csvName);
            const badgeText = getBadgeText(score);
            const scoreClass = getScoreClass(score);
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="result-item">
                    <strong>Search:</strong> "${searchName}"<br>
                    <strong>CSV:</strong> "${csvName}"<br>
                    <strong>Score:</strong> <span class="score ${scoreClass}">${score}</span><br>
                    <strong>Badge:</strong> <span class="badge">${badgeText}</span><br>
                    <strong>Match:</strong> ${score >= 60 ? '‚úÖ YES' : '‚ùå NO'}
                </div>
            `;
        }

        function runAllTests() {
            const testCases = [
                { search: 'Google', csv: 'Google LLC', expected: 95 },
                { search: 'Microsoft Corporation', csv: 'Microsoft', expected: 95 },
                { search: 'Amazon', csv: 'Amazon Web Services', expected: 90 },
                { search: 'Meta', csv: 'Meta Platforms Inc', expected: 90 },
                { search: 'Accenture', csv: 'Accenture UK Limited', expected: 90 },
                { search: 'Deloitte', csv: 'Deloitte LLP', expected: 95 },
                { search: 'Apple Inc', csv: 'Apple', expected: 95 },
                { search: 'IBM', csv: 'International Business Machines', expected: 65 },
                { search: 'JP Morgan', csv: 'JPMorgan Chase & Co', expected: 75 },
                { search: 'Goldman Sachs', csv: 'The Goldman Sachs Group Inc', expected: 85 },
                { search: 'Apple', csv: 'Microsoft', expected: 0 },
                { search: 'Google', csv: 'Amazon', expected: 0 }
            ];

            let html = '<h3>Test Results:</h3>';
            let passed = 0;
            let failed = 0;

            testCases.forEach(test => {
                const score = calculateFuzzyMatchScore(test.search, test.csv);
                const badgeText = getBadgeText(score);
                const scoreClass = getScoreClass(score);
                const isPass = Math.abs(score - test.expected) <= 10; // Allow 10 point variance
                
                if (isPass) passed++;
                else failed++;

                html += `
                    <div class="result-item">
                        ${isPass ? '‚úÖ' : '‚ùå'} 
                        <strong>Search:</strong> "${test.search}" | 
                        <strong>CSV:</strong> "${test.csv}"<br>
                        <strong>Score:</strong> <span class="score ${scoreClass}">${score}</span> 
                        (Expected: ~${test.expected})<br>
                        <strong>Badge:</strong> <span class="badge">${badgeText}</span>
                    </div>
                `;
            });

            html += `<h3>Summary: ${passed} passed, ${failed} failed</h3>`;
            document.getElementById('allResults').innerHTML = html;
        }

        // Run a test on page load
        window.onload = () => {
            runTest();
        };
    </script>
</body>
</html>

